'use strict';

var _yargs = require('yargs');

var _yargs2 = _interopRequireDefault(_yargs);

var _log = require('./utils/log');

var _package = require('../package.json');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// Workaround to remove display of script name in help. See:
// * https://github.com/yargs/yargs/pull/1143
// * https://github.com/yargs/yargs/issues/1065
// * https://github.com/yargs/yargs/issues/1048
function fixHelp(output) {
  return output.replace(/( +)contentful\.js/g, '$1');
}

_yargs2.default.usage('\nUsage: contentful <cmd> [args]').commandDir('cmds').demandCommand(4, 'Please specify a command.').help('h').alias('h', 'help').strict().recommendCommands().option('v', {
  alias: 'version',
  global: false,
  type: 'boolean',
  describe: 'Show current version',
  skipValidation: true
}).version(false).epilog('Copyright 2018 Contentful, this is a BETA release').fail(function (msg, err, yargs) {
  if (err) throw err;
  console.error(fixHelp(yargs.help()));
  console.error(msg);
  process.exit(1);
}).parse(process.argv.slice(2), (_, argv, output) => {
  if (argv.help || argv.h) {
    output = fixHelp(output);
  }
  if (argv.version === true && !argv._.length) {
    (0, _log.log)(_package.version);
  } else {
    (0, _log.log)(output);
  }
});